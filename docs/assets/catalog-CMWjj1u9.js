import"./form-DrtEXl28.js";import{r as $,p as P}from"./main-CE9eG4OX.js";const B=12,F=9,x=1340;let y=T(),p=1,h=[...P];document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("catalogFilters"),n=document.querySelector('[data-product-grid="catalog"]'),s=document.querySelector("[data-product-count]"),i=document.getElementById("catalogSort"),f=document.getElementById("clearFilters"),d=document.querySelector("[data-pagination]"),g=document.querySelector("[data-catalog-filters-open]"),m=document.querySelector(".catalog-sidebar"),a=document.querySelector("[data-catalog-filters-close]"),c=e.querySelector(".catalog-filters__submit");if(!e||!n)return;C(),S();const _=new URLSearchParams(window.location.search).get("product");if(_){const t=()=>{const r=document.querySelector(`[data-product-id="${_}"], [data-productid="${_}"]`);if(r){const l=document.querySelector(".header"),u=l?l.offsetHeight:88,L=r.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:L-u-20,behavior:"smooth"}),r.style.transition="box-shadow 0.3s ease",r.style.boxShadow="0 0 0 3px rgba(93, 169, 255, 0.5)",setTimeout(()=>{r.style.boxShadow=""},2e3)}};setTimeout(t,500);const o=new MutationObserver(()=>{t(),o.disconnect()});o.observe(n,{childList:!0})}const b=()=>{const t=new FormData(e),o={types:t.getAll("type"),volumes:t.getAll("volume"),volumeFrom:t.get("volumeFrom"),volumeTo:t.get("volumeTo"),necks:t.getAll("neck"),purposes:t.getAll("purpose"),sort:i?i.value:"default"};h=P.filter(r=>I(r,o)),o.sort!=="default"&&(h=h.slice().sort((r,l)=>O(r,l,o.sort))),p=1,w(n),M(h.length,s),v(d,h.length),A(),q(o)};function q(t){const o=new URLSearchParams;t.types.length>0&&t.types.forEach(u=>o.append("type",u)),t.volumes.length>0&&t.volumes.forEach(u=>o.append("volume",u)),t.necks.length>0&&t.necks.forEach(u=>o.append("neck",u)),t.purposes.length>0&&t.purposes.forEach(u=>{o.append("purpose",u)}),t.sort&&t.sort!=="default"&&o.set("sort",t.sort);const r=new URLSearchParams(window.location.search).get("product");r&&o.set("product",r);const l=window.location.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},"",l),setTimeout(()=>{h.forEach((u,L)=>{const k=n.children[L];k&&(k.setAttribute("data-product-id",u.id),k.dataset.productId=u.id)})},100)}function S(){const t=new URLSearchParams(window.location.search);if(t.getAll("type").forEach(o=>{const r=e.querySelector(`input[name="type"][value="${o}"]`);r&&(r.checked=!0)}),t.getAll("volume").forEach(o=>{const r=e.querySelector(`input[name="volume"][value="${o}"]`);r&&(r.checked=!0)}),t.getAll("neck").forEach(o=>{const r=e.querySelector(`input[name="neck"][value="${o}"]`);r&&(r.checked=!0)}),t.getAll("purpose").forEach(o=>{if(o.includes("|"))o.split("|").map(l=>l.trim()).forEach(l=>{const u=e.querySelector(`input[name="purpose"][value="${l}"]`);u&&(u.checked=!0)});else{const r=e.querySelector(`input[name="purpose"][value="${o}"]`);r&&(r.checked=!0)}}),i){const o=t.get("sort");o&&(i.value=o)}}function A(){const o=n.getBoundingClientRect().top+window.pageYOffset-88;R(n)||window.scrollTo({top:o,behavior:"smooth"})}function R(t){const o=t.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&o.right<=(window.innerWidth||document.documentElement.clientWidth)}function C(){e.querySelectorAll(".catalog-filters__label").forEach(o=>{const r=o.parentElement;r.classList.add("filter-group--expanded"),o.addEventListener("click",l=>{l.target.type!=="checkbox"&&r.classList.toggle("filter-group--expanded")})})}e.querySelectorAll('input[type="checkbox"]').forEach(t=>{t.addEventListener("change",()=>{window.innerWidth>x&&b()})}),i&&i.addEventListener("change",b),f&&f.addEventListener("click",()=>{e.reset(),b()});function E(){m&&(m.classList.remove("catalog-sidebar--mobile-open"),document.body.style.overflow="",document.documentElement.style.overflow="",c&&(c.textContent="Применить фильтр",c.classList.remove("btn__outline"),c.classList.add("btn__primary"),c.dataset.state="apply"))}g&&m?(g.addEventListener("click",()=>{m.classList.add("catalog-sidebar--mobile-open"),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.innerWidth<=x&&e.querySelectorAll(".catalog-filters__label").forEach(o=>{const r=o.parentElement,l=r.querySelector(".catalog-filters__checkboxes");r.classList.contains("filter-group--expanded")||(r.classList.add("filter-group--expanded"),requestAnimationFrame(()=>{l.style.maxHeight="none";const u=l.scrollHeight;l.style.maxHeight=u+"px",l.style.opacity="1"}))}),c&&(c.textContent="Применить фильтр",c.classList.remove("btn__outline"),c.classList.add("btn__primary"),c.dataset.state="apply")}),m.addEventListener("click",t=>{t.target===m&&E()}),a&&a.addEventListener("click",()=>{E()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&m.classList.contains("catalog-sidebar--mobile-open")&&E()}),c&&c.addEventListener("click",t=>{t.preventDefault(),(c.dataset.state||"apply")==="apply"?(b(),c.textContent="Показать",c.classList.remove("btn__primary"),c.classList.add("btn__outline"),c.dataset.state="show"):E()}),e.addEventListener("submit",t=>{t.preventDefault()})):e.addEventListener("submit",t=>{t.preventDefault(),b()}),b(),window.restoreFiltersFromURL=S,window.addEventListener("resize",()=>{const t=T();t!==y&&(y=t,p=1,w(n),v(d,h.length))})});function T(){return window.innerWidth<768?F:B}function I(e,n){if(n.types.length>0&&!n.types.includes(e.type))return!1;if(n.necks.length>0){let s=!1;if(n.necks.forEach(i=>{const f=`${e.neck} ${e.standard}`.trim();if(f.includes(i)||i.includes(f)){s=!0;return}if(e.neck&&(i===e.neck||e.neck.includes(i))){s=!0;return}if(e.neck&&e.neck.includes(";")&&e.neck.split(";").map(g=>g.trim()).some(g=>g.includes(i)||i.includes(g))){s=!0;return}}),!s)return!1}if(n.purposes.length>0){let s=!1;const i=e.purpose.split(";").map(f=>f.trim());if(n.purposes.forEach(f=>{if(i.some(d=>d.includes(f)||f.includes(d))){s=!0;return}}),!s)return!1}if(n.volumes.length>0&&e.volume){const s=parseFloat(e.volume.replace(" л","").replace(",","."));if(!n.volumes.some(f=>{const[d,g]=f.split("-").map(parseFloat);return s>=d&&s<=g}))return!1}return!(n.volumes.length>0&&!e.volume)}function O(e,n,s){return s==="priceAsc"?e.price-n.price:s==="priceDesc"?n.price-e.price:0}function M(e,n){if(!n)return;const s=D(e);n.textContent=`Найдено ${e} ${s}`}function D(e){const n=e%10,s=e%100;return n===1&&s!==11?"позиция":n>=2&&n<=4&&(s<10||s>=20)?"позиции":"позиций"}function v(e,n){var g,m;if(!e)return;const s=Math.ceil(n/y);if(s<=1){e.innerHTML="";return}const i=[];if(s<=5)for(let a=1;a<=s;a++)i.push(a);else if(p<=3){for(let a=1;a<=4;a++)i.push(a);i.push("ellipsis"),i.push(s)}else if(p>=s-2){i.push(1),i.push("ellipsis");for(let a=s-3;a<=s;a++)i.push(a)}else{i.push(1),i.push("ellipsis");for(let a=p-1;a<=p+1;a++)i.push(a);i.push("ellipsis"),i.push(s)}e.innerHTML=`
        <button class="catalog-pagination__btn catalog-pagination__btn--prev btn__outline" ${p===1?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Назад">
        </button>
        <div class="catalog-pagination__pages">
            ${i.map(a=>a==="ellipsis"?'<span class="pagination__ellipsis">...</span>':`<button class="catalog-pagination__page ${a===p?"catalog-pagination__page--active":""}" data-page="${a}">${a}</button>`).join("")}
        </div>
        <button class="catalog-pagination__btn catalog-pagination__btn--next btn__outline" ${p===s?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Вперед">
        </button>
    `;const d=document.querySelector('[data-product-grid="catalog"]');e.querySelectorAll(".catalog-pagination__page").forEach(a=>{a.addEventListener("click",()=>{p=parseInt(a.dataset.page),w(d),v(e,n);const c=d.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:c-88,behavior:"smooth"})})}),(g=e.querySelector(".catalog-pagination__btn--prev"))==null||g.addEventListener("click",()=>{if(p>1){p--,w(d),v(e,n);const a=d.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:a-88,behavior:"smooth"})}}),(m=e.querySelector(".catalog-pagination__btn--next"))==null||m.addEventListener("click",()=>{if(p<s){p++,w(d),v(e,n);const a=d.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:a-88,behavior:"smooth"})}})}function w(e){if(!e)return;const n=(p-1)*y,s=n+y,i=h.slice(n,s);$(e,i,"Нет товаров по заданным параметрам")}
