(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function c(){typeof emailjs<"u"&&emailjs.init("bkNMM51XqfqT68kLx"),["customForm","modalForm"].forEach(l=>{const e=document.getElementById(l);e&&(e.dataset.initialized==="true"&&(e._submitHandler&&(e.removeEventListener("submit",e._submitHandler),e._submitHandler=null),e.dataset.initialized="false"),(!e.dataset.initialized||e.dataset.initialized==="false")&&(new d(l),e.dataset.initialized="true"))})}document.addEventListener("DOMContentLoaded",()=>{if(typeof emailjs>"u"){const l=setInterval(()=>{typeof emailjs<"u"&&(clearInterval(l),c())},100);setTimeout(()=>{clearInterval(l),c()},5e3)}else c()});window.initForms=c;const a={emailService:{serviceID:"service_ya8bqsn",templateID:"template_8b667mk",publicKey:"0nE1_N7ayyxrXtTP_"},patterns:{name:/^[а-яА-ЯёЁa-zA-Z\s-]{2,50}$/,phone:/^\+7\s\d{3}\s\d{3}\s\d{2}\s-\s\d{2}$/,email:/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/},messages:{requiredName:"Пожалуйста, укажите имя",requiredPhone:"Пожалуйста, укажите телефон",requiredEmail:"Пожалуйста, укажите email",invalidName:"Имя должно содержать 2-50 букв",invalidPhone:"Введите телефон в формате: +7 900 900 90 - 90",invalidEmail:"Введите корректный email адрес",agreementRequired:"Необходимо согласие"}};class u{constructor(e){this.input=e,this.input&&this.init()}init(){this.input.addEventListener("input",e=>this.formatPhone(e)),this.input.addEventListener("keydown",e=>this.handleKeyDown(e)),this.input.addEventListener("blur",()=>this.validateCompletePhone())}formatPhone(e){const t=e.target.selectionStart;let s=e.target.value.replace(/\D/g,"");const i=e.inputType==="deleteContentBackward";s.length>11&&(s=s.substring(0,11));let r="";s.length>0&&(r="+7 ",s.length>1&&(r+=s.substring(1,4)),s.length>=4&&(r+=` ${s.substring(4,7)}`),s.length>=7&&(r+=` ${s.substring(7,9)}`),s.length>=9&&(r+=` - ${s.substring(9,11)}`));const o=e.target.value;e.target.value=r;let n=t;if(i&&o.length>r.length)n=Math.max(0,t-(o.length-r.length));else if(!i){const m=r.length-o.length;m>0&&(n=t+m)}n=Math.min(n,r.length),e.target.setSelectionRange(n,n)}handleKeyDown(e){const t=[8,9,27,13,46,37,38,39,40],s=[65,67,86,88];if(t.includes(e.keyCode)||e.ctrlKey&&s.includes(e.keyCode))return;e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||e.preventDefault()}validateCompletePhone(){if(!this.input.value)return;this.input.value.replace(/\D/g,"").length!==11&&this.input.classList.add("form__input--error")}}class d{constructor(e){if(this.form=document.getElementById(e),!this.form)return;const t=e==="modalForm";this.inputs={name:document.getElementById(t?"modalFormName":"formName"),phone:document.getElementById(t?"modalFormPhone":"formPhone"),email:document.getElementById(t?"modalFormEmail":"formEmail"),agree:document.getElementById(t?"modalFormAgree":"formAgree"),privacy:t?document.getElementById("modalFormPrivacy"):null},this.errors={name:document.getElementById(t?"modalNameError":"nameError"),phone:document.getElementById(t?"modalPhoneError":"phoneError"),email:document.getElementById(t?"modalEmailError":"emailError"),agree:document.getElementById(t?"modalAgreeError":"agreeError"),privacy:t?document.getElementById("modalPrivacyError"):null},this.isModal=t,this.phoneMask=this.inputs.phone?new u(this.inputs.phone):null,this.init()}init(){this.setupEventListeners(),this.setupRealTimeValidation()}setupEventListeners(){if(!this.form){console.warn("Form not found for validator");return}const e=this.form._submitHandler;e&&this.form.removeEventListener("submit",e),this.form._submitHandler=s=>{this.handleSubmit(s)},this.form.addEventListener("submit",this.form._submitHandler,!0);const t=this.form.querySelector('button[type="submit"], input[type="submit"]');t&&t.addEventListener("click",s=>{}),Object.values(this.inputs).forEach(s=>{!s||s.type==="checkbox"||s.addEventListener("input",()=>{this.clearError(s),this.updateInputState(s)})}),this.inputs.agree&&this.inputs.agree.addEventListener("change",()=>{this.clearError(this.inputs.agree)}),this.inputs.privacy&&this.inputs.privacy.addEventListener("change",()=>{this.clearError(this.inputs.privacy)})}setupRealTimeValidation(){Object.values(this.inputs).forEach(e=>{!e||e.type==="checkbox"||e.addEventListener("blur",()=>{this.validateField(e)})})}validateField(e){if(!e)return!0;const t=e.value.trim();let s=!0,i="";switch(e.name){case"name":t?a.patterns.name.test(t)||(s=!1,i=a.messages.invalidName):(s=!1,i=a.messages.requiredName);break;case"phone":t?a.patterns.phone.test(t)||(s=!1,i=a.messages.invalidPhone):(s=!1,i=a.messages.requiredPhone);break;case"email":t?this.validateEmail(t)||(s=!1,i=a.messages.invalidEmail):(s=!1,i=a.messages.requiredEmail);break}return s?(this.clearError(e),this.markAsSuccess(e),e.setCustomValidity("")):(this.showError(e,i),e.setCustomValidity(" ")),s}validateEmail(e){if(!a.patterns.email.test(e))return!1;const[t,s]=e.split("@");return!t||!s||t.length>64||s.length>253?!1:/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(s)}validateForm(){let e=!0;return Object.values(this.inputs).forEach(t=>{t&&t.type!=="checkbox"&&!this.validateField(t)&&(e=!1)}),this.inputs.agree&&!this.inputs.agree.checked?(this.showError(this.inputs.agree,a.messages.agreementRequired),e=!1):this.inputs.agree&&this.clearError(this.inputs.agree),this.isModal&&this.inputs.privacy&&!this.inputs.privacy.checked?(this.showError(this.inputs.privacy,a.messages.agreementRequired),e=!1):this.inputs.privacy&&this.clearError(this.inputs.privacy),e}showError(e,t){if(!e)return;const s=this.errors[e.name]||this.errors[e.name==="privacy"?"privacy":e.name];e.type!=="checkbox"&&(e.classList.add("form__input--error"),e.classList.remove("form__input--success","form__input--filled")),s&&(s.textContent=t)}clearError(e){if(!e)return;const t=this.errors[e.name];e.classList.remove("form__input--error"),t&&(t.textContent="")}markAsSuccess(e){e&&e.classList.add("form__input--success","form__input--filled")}updateInputState(e){e&&(e.value.trim()?e.classList.add("form__input--filled"):e.classList.remove("form__input--filled","form__input--success"))}async handleSubmit(e){e.preventDefault(),e.stopPropagation();let t=!0;if(Object.values(this.inputs).forEach(i=>{i&&i.type!=="checkbox"&&(!(i.value&&i.value.trim())||!this.validateField(i))&&(t=!1)}),this.inputs.agree&&!this.inputs.agree.checked?(this.showError(this.inputs.agree,a.messages.agreementRequired),t=!1):this.inputs.agree&&this.clearError(this.inputs.agree),this.isModal&&this.inputs.privacy&&!this.inputs.privacy.checked?(this.showError(this.inputs.privacy,a.messages.agreementRequired),t=!1):this.inputs.privacy&&this.clearError(this.inputs.privacy),!t)return console.log("Form validation failed, submission blocked"),!1;const s={name:this.inputs.name?this.inputs.name.value.trim():"",phone:this.inputs.phone?this.inputs.phone.value.trim():"",email:this.inputs.email?this.inputs.email.value.trim():"",agree:this.inputs.agree?this.inputs.agree.checked:!1};try{await this.sendFormData(s),this.showSuccessPopup(),this.form.reset(),this.clearAllErrors()}catch(i){console.error("Ошибка отправки формы:",i),this.showErrorPopup("Произошла ошибка при отправке формы. Пожалуйста, попробуйте еще раз.")}}async sendFormData(e){if(typeof emailjs<"u"){const i={name:e.name,phone:e.phone,email:e.email,date:new Date().toLocaleString("ru-RU")};return emailjs.send(a.emailService.serviceID,a.emailService.templateID,i,a.emailService.publicKey)}const t=encodeURIComponent("Заявка с сайта ПЭТ-Хаус НН"),s=encodeURIComponent(`Новая заявка:

Имя: ${e.name}
Телефон: ${e.phone}
Email: ${e.email}`);return window.location.href=`mailto:your-email@domain.com?subject=${t}&body=${s}`,Promise.resolve()}showSuccessPopup(){if(this.isModal){const r=document.getElementById("contactModal");r&&r.classList.remove("active")}const e=document.getElementById("successPopup");if(!e)return;e.classList.add("active"),document.body.style.overflow="hidden";const t=e.querySelector(".popup__close"),s=e.querySelector(".popup__close-btn"),i=()=>{e.classList.remove("active"),document.body.style.overflow=""};t&&(t.onclick=i),s&&(s.onclick=i),e.onclick=r=>{r.target===e&&i()}}showErrorPopup(e){if(this.isModal){const n=document.getElementById("contactModal");n&&n.classList.remove("active")}const t=document.getElementById("errorPopup");if(!t)return;const s=t.querySelector("#errorPopupText");s&&(s.textContent=e||"Произошла ошибка при отправке формы. Пожалуйста, попробуйте еще раз."),t.classList.add("active"),document.body.style.overflow="hidden";const i=t.querySelector(".popup__close"),r=t.querySelector(".popup__close-btn"),o=()=>{t.classList.remove("active"),document.body.style.overflow=""};i&&(i.onclick=o),r&&(r.onclick=o),t.onclick=n=>{n.target===t&&o()}}clearAllErrors(){Object.values(this.inputs).forEach(e=>{e&&(this.clearError(e),e.classList.remove("form__input--filled","form__input--success"))})}}
