import"./form-B3vzQVna.js";import{r as $,p as A}from"./main-DlQl-Wyu.js";const I=12,B=9,q=1340;let S=C(),m=1,b=[...A];document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("catalogFilters"),s=document.querySelector('[data-product-grid="catalog"]'),n=document.querySelector("[data-product-count]"),l=document.getElementById("catalogSort"),c=document.getElementById("clearFilters"),u=document.querySelector("[data-pagination]"),f=document.querySelector("[data-catalog-filters-open]"),g=document.querySelector(".catalog-sidebar"),i=document.querySelector("[data-catalog-filters-close]"),o=e.querySelector(".catalog-filters__submit");if(!e||!s)return;F(),_(),M();const h=new URLSearchParams(window.location.search).get("product");if(h){const t=()=>{const a=document.querySelector(`[data-product-id="${h}"], [data-productid="${h}"]`);if(a){const d=document.querySelector(".header"),p=d?d.offsetHeight:88,P=a.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:P-p-20,behavior:"smooth"}),a.style.transition="box-shadow 0.3s ease",a.style.boxShadow="0 0 0 3px rgba(93, 169, 255, 0.5)",setTimeout(()=>{a.style.boxShadow=""},2e3)}};setTimeout(t,500);const r=new MutationObserver(()=>{t(),r.disconnect()});r.observe(s,{childList:!0})}const v=()=>{const t=new FormData(e),r={types:t.getAll("type"),volumes:t.getAll("volume"),volumeFrom:t.get("volumeFrom"),volumeTo:t.get("volumeTo"),necks:t.getAll("neck"),purposes:t.getAll("purpose"),sort:l?l.value:"default"};b=A.filter(a=>D(a,r)),r.sort!=="default"&&(b=b.slice().sort((a,d)=>H(a,d,r.sort))),m=1,L(s),O(b.length,n),E(u,b.length),x(),y(r)};function y(t){const r=new URLSearchParams;t.types.length>0&&t.types.forEach(p=>r.append("type",p)),t.volumes.length>0&&t.volumes.forEach(p=>r.append("volume",p)),t.necks.length>0&&t.necks.forEach(p=>r.append("neck",p)),t.purposes.length>0&&t.purposes.forEach(p=>{r.append("purpose",p)}),t.sort&&t.sort!=="default"&&r.set("sort",t.sort);const a=new URLSearchParams(window.location.search).get("product");a&&r.set("product",a);const d=window.location.pathname+(r.toString()?"?"+r.toString():"");window.history.replaceState({},"",d),setTimeout(()=>{b.forEach((p,P)=>{const T=s.children[P];T&&(T.setAttribute("data-product-id",p.id),T.dataset.productId=p.id)})},100)}function _(){const t=new URLSearchParams(window.location.search);if(t.getAll("type").forEach(r=>{const a=e.querySelector(`input[name="type"][value="${r}"]`);a&&(a.checked=!0)}),t.getAll("volume").forEach(r=>{const a=e.querySelector(`input[name="volume"][value="${r}"]`);a&&(a.checked=!0)}),t.getAll("neck").forEach(r=>{const a=e.querySelector(`input[name="neck"][value="${r}"]`);a&&(a.checked=!0)}),t.getAll("purpose").forEach(r=>{if(r.includes("|"))r.split("|").map(d=>d.trim()).forEach(d=>{const p=e.querySelector(`input[name="purpose"][value="${d}"]`);p&&(p.checked=!0)});else{const a=e.querySelector(`input[name="purpose"][value="${r}"]`);a&&(a.checked=!0)}}),l){const r=t.get("sort");r&&(l.value=r)}}function x(){const r=s.getBoundingClientRect().top+window.pageYOffset-88;R(s)||window.scrollTo({top:r,behavior:"smooth"})}function R(t){const r=t.getBoundingClientRect();return r.top>=0&&r.left>=0&&r.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&r.right<=(window.innerWidth||document.documentElement.clientWidth)}function F(){e.querySelectorAll(".catalog-filters__label").forEach(r=>{const a=r.parentElement;a.classList.add("filter-group--expanded"),r.addEventListener("click",d=>{d.target.type!=="checkbox"&&a.classList.toggle("filter-group--expanded")})})}e.querySelectorAll('input[type="checkbox"]').forEach(t=>{t.addEventListener("change",()=>{window.innerWidth>q&&v()})}),l&&l.addEventListener("change",v),c&&c.addEventListener("click",()=>{e.reset(),v()});function k(){g&&(g.classList.remove("catalog-sidebar--mobile-open"),document.body.style.overflow="",document.documentElement.style.overflow="",o&&(o.textContent="Применить фильтр",o.classList.remove("btn__outline"),o.classList.add("btn__primary"),o.dataset.state="apply"))}f&&g?(f.addEventListener("click",()=>{g.classList.add("catalog-sidebar--mobile-open"),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.innerWidth<=q&&e.querySelectorAll(".catalog-filters__label").forEach(r=>{const a=r.parentElement,d=a.querySelector(".catalog-filters__checkboxes");a.classList.contains("filter-group--expanded")||(a.classList.add("filter-group--expanded"),requestAnimationFrame(()=>{d.style.maxHeight="none";const p=d.scrollHeight;d.style.maxHeight=p+"px",d.style.opacity="1"}))}),o&&(o.textContent="Применить фильтр",o.classList.remove("btn__outline"),o.classList.add("btn__primary"),o.dataset.state="apply")}),g.addEventListener("click",t=>{t.target===g&&k()}),i&&i.addEventListener("click",()=>{k()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&g.classList.contains("catalog-sidebar--mobile-open")&&k()}),o&&o.addEventListener("click",t=>{t.preventDefault(),(o.dataset.state||"apply")==="apply"?(v(),o.textContent="Показать",o.classList.remove("btn__primary"),o.classList.add("btn__outline"),o.dataset.state="show"):k()}),e.addEventListener("submit",t=>{t.preventDefault()})):e.addEventListener("submit",t=>{t.preventDefault(),v()}),v(),window.restoreFiltersFromURL=_,window.addEventListener("resize",()=>{const t=C();t!==S&&(S=t,m=1,L(s),E(u,b.length))})});function C(){return window.innerWidth<768?B:I}function D(e,s){if(s.types.length>0&&!s.types.includes(e.type))return!1;if(s.necks.length>0){let n=!1;if(s.necks.forEach(l=>{const c=`${e.neck} ${e.standard}`.trim();if(c.includes(l)||l.includes(c)){n=!0;return}if(e.neck&&(l===e.neck||e.neck.includes(l))){n=!0;return}if(e.neck&&e.neck.includes(";")&&e.neck.split(";").map(f=>f.trim()).some(f=>f.includes(l)||l.includes(f))){n=!0;return}}),!n)return!1}if(s.purposes.length>0){let n=!1;const l=e.purpose.split(";").map(c=>c.trim());if(s.purposes.forEach(c=>{if(l.some(u=>u.includes(c)||c.includes(u))){n=!0;return}}),!n)return!1}if(s.volumes.length>0&&e.volume){const n=parseFloat(e.volume.replace(" л","").replace(",","."));if(!s.volumes.some(c=>{const[u,f]=c.split("-").map(parseFloat);return n>=u&&n<=f}))return!1}return!(s.volumes.length>0&&!e.volume)}function H(e,s,n){return n==="priceAsc"?e.price-s.price:n==="priceDesc"?s.price-e.price:0}function O(e,s){if(!s)return;const n=Y(e);s.textContent=`Найдено ${e} ${n}`}function Y(e){const s=e%10,n=e%100;return s===1&&n!==11?"позиция":s>=2&&s<=4&&(n<10||n>=20)?"позиции":"позиций"}function E(e,s){var f,g;if(!e)return;const n=Math.ceil(s/S);if(n<=1){e.innerHTML="";return}const l=[];if(n<=5)for(let i=1;i<=n;i++)l.push(i);else if(m<=3){for(let i=1;i<=4;i++)l.push(i);l.push("ellipsis"),l.push(n)}else if(m>=n-2){l.push(1),l.push("ellipsis");for(let i=n-3;i<=n;i++)l.push(i)}else{l.push(1),l.push("ellipsis");for(let i=m-1;i<=m+1;i++)l.push(i);l.push("ellipsis"),l.push(n)}e.innerHTML=`
        <button class="catalog-pagination__btn catalog-pagination__btn--prev btn__outline" ${m===1?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Назад">
        </button>
        <div class="catalog-pagination__pages">
            ${l.map(i=>i==="ellipsis"?'<span class="pagination__ellipsis">...</span>':`<button class="catalog-pagination__page ${i===m?"catalog-pagination__page--active":""}" data-page="${i}">${i}</button>`).join("")}
        </div>
        <button class="catalog-pagination__btn catalog-pagination__btn--next btn__outline" ${m===n?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Вперед">
        </button>
    `;const u=document.querySelector('[data-product-grid="catalog"]');e.querySelectorAll(".catalog-pagination__page").forEach(i=>{i.addEventListener("click",()=>{m=parseInt(i.dataset.page),L(u),E(e,s);const o=u.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:o-88,behavior:"smooth"})})}),(f=e.querySelector(".catalog-pagination__btn--prev"))==null||f.addEventListener("click",()=>{if(m>1){m--,L(u),E(e,s);const i=u.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:i-88,behavior:"smooth"})}}),(g=e.querySelector(".catalog-pagination__btn--next"))==null||g.addEventListener("click",()=>{if(m<n){m++,L(u),E(e,s);const i=u.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:i-88,behavior:"smooth"})}})}function L(e){if(!e)return;const s=(m-1)*S,n=s+S,l=b.slice(s,n);$(e,l,"Нет товаров по заданным параметрам")}function M(){const e=document.querySelector(".catalog-filters");if(!e||window.innerWidth<=1340)return;let s=!1,n=!1,l=0;function c(o){return o?e.contains(o)||o===e:!1}function u(o){if(n&&c(o.target))return o.preventDefault(),o.stopPropagation(),!1}e.addEventListener("mouseenter",()=>{s=!0}),e.addEventListener("mouseleave",o=>{setTimeout(()=>{const w=document.querySelector(":hover");c(w)||(s=!1,n=!1)},50)}),e.addEventListener("wheel",o=>{if(!s)return;const w=Date.now();if(w-l<16)return;l=w;const h=o.deltaY,v=e.scrollHeight-e.clientHeight,y=e.scrollTop,_=y>0&&h<0,x=y<v&&h>0;_||x?(n=!0,o.preventDefault(),o.stopPropagation(),e.scrollTop+=h*.9,(y<=0&&h<0||y>=v&&h>0)&&setTimeout(()=>{n=!1},100)):n=!1},{passive:!1}),document.addEventListener("wheel",u,{passive:!1}),document.addEventListener("touchmove",u,{passive:!1});let f=0,g=0,i=!1;if(e.addEventListener("touchstart",o=>{c(o.target)&&(i=!0,s=!0,n=!0,f=o.touches[0].clientY,g=e.scrollTop)},{passive:!0}),e.addEventListener("touchmove",o=>{if(i&&n){o.preventDefault(),o.stopPropagation();const w=o.touches[0].clientY,h=f-w;e.scrollTop=g+h*1.2}},{passive:!1}),e.addEventListener("touchend",()=>{i=!1,n=!1,setTimeout(()=>{const o=document.querySelector(":hover");c(o)||(s=!1)},300)}),window.addEventListener("resize",()=>{window.innerWidth<=1340&&(s=!1,n=!1)}),!document.getElementById("smooth-scroll-styles")){const o=document.createElement("style");o.id="smooth-scroll-styles",o.textContent=`
            .catalog-filters {
                scroll-behavior: smooth;
                -webkit-overflow-scrolling: touch;
                overflow-y: auto;
                overflow-x: hidden;
                max-height: 70vh;
            }

            .catalog-filters::-webkit-scrollbar {
                width: 4px;
                background: transparent;
            }
            
            .catalog-filters::-webkit-scrollbar-thumb {
                background: rgba(93, 169, 255, 0.3);
                border-radius: 2px;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .catalog-filters:hover::-webkit-scrollbar-thumb {
                opacity: 1;
            }
        `,document.head.appendChild(o)}}
