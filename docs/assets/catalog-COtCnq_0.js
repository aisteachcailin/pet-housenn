import"./form-CRtfJV1G.js";import{r as $,p as q}from"./main-aXPtoK7-.js";const D=12,I=9,T=768;let E=A(),f=1,v=[...q];document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("catalogFilters"),s=document.querySelector('[data-product-grid="catalog"]'),r=document.querySelector("[data-product-count]"),l=document.getElementById("catalogSort"),p=document.getElementById("clearFilters"),c=document.querySelector("[data-pagination]"),g=document.querySelector("[data-catalog-filters-open]"),m=document.querySelector(".catalog-sidebar"),n=document.querySelector("[data-catalog-filters-close]"),a=e.querySelector(".catalog-filters__submit");if(!e||!s)return;R(),_(),U();const b=new URLSearchParams(window.location.search).get("product");if(b){const t=()=>{const i=document.querySelector(`[data-product-id="${b}"], [data-productid="${b}"]`);if(i){const u=document.querySelector(".header"),d=u?u.offsetHeight:88,x=i.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:x-d-20,behavior:"smooth"}),i.style.transition="box-shadow 0.3s ease",i.style.boxShadow="0 0 0 3px rgba(93, 169, 255, 0.5)",setTimeout(()=>{i.style.boxShadow=""},2e3)}};setTimeout(t,500);const o=new MutationObserver(()=>{t(),o.disconnect()});o.observe(s,{childList:!0})}const h=()=>{const t=new FormData(e),o={types:t.getAll("type"),volumes:t.getAll("volume"),volumeFrom:t.get("volumeFrom"),volumeTo:t.get("volumeTo"),necks:t.getAll("neck"),purposes:t.getAll("purpose"),sort:l?l.value:"default"};v=q.filter(i=>O(i,o)),o.sort!=="default"&&(v=v.slice().sort((i,u)=>B(i,u,o.sort))),f=1,y(s),H(v.length,r),w(c,v.length),C(),k(o)};function k(t){const o=new URLSearchParams;t.types.length>0&&t.types.forEach(d=>o.append("type",d)),t.volumes.length>0&&t.volumes.forEach(d=>o.append("volume",d)),t.necks.length>0&&t.necks.forEach(d=>o.append("neck",d)),t.purposes.length>0&&t.purposes.forEach(d=>{o.append("purpose",d)}),t.sort&&t.sort!=="default"&&o.set("sort",t.sort);const i=new URLSearchParams(window.location.search).get("product");i&&o.set("product",i);const u=window.location.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},"",u),setTimeout(()=>{v.forEach((d,x)=>{const P=s.children[x];P&&(P.setAttribute("data-product-id",d.id),P.dataset.productId=d.id)})},100)}function _(){const t=new URLSearchParams(window.location.search);if(t.getAll("type").forEach(o=>{const i=e.querySelector(`input[name="type"][value="${o}"]`);i&&(i.checked=!0)}),t.getAll("volume").forEach(o=>{const i=e.querySelector(`input[name="volume"][value="${o}"]`);i&&(i.checked=!0)}),t.getAll("neck").forEach(o=>{const i=e.querySelector(`input[name="neck"][value="${o}"]`);i&&(i.checked=!0)}),t.getAll("purpose").forEach(o=>{if(o.includes("|"))o.split("|").map(u=>u.trim()).forEach(u=>{const d=e.querySelector(`input[name="purpose"][value="${u}"]`);d&&(d.checked=!0)});else{const i=e.querySelector(`input[name="purpose"][value="${o}"]`);i&&(i.checked=!0)}}),l){const o=t.get("sort");o&&(l.value=o)}}function C(){const o=s.getBoundingClientRect().top+window.pageYOffset-88;F(s)||window.scrollTo({top:o,behavior:"smooth"})}function F(t){const o=t.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&o.right<=(window.innerWidth||document.documentElement.clientWidth)}function R(){e.querySelectorAll(".catalog-filters__label").forEach(o=>{const i=o.parentElement;i.classList.add("filter-group--expanded"),o.addEventListener("click",u=>{u.target.type!=="checkbox"&&i.classList.toggle("filter-group--expanded")})})}e.querySelectorAll('input[type="checkbox"]').forEach(t=>{t.addEventListener("change",()=>{window.innerWidth>T&&h()})}),l&&l.addEventListener("change",h),p&&p.addEventListener("click",()=>{e.reset(),h()});function S(){m&&(m.classList.remove("catalog-sidebar--mobile-open"),document.body.style.overflow="",document.documentElement.style.overflow="",a&&(a.textContent="Применить фильтр",a.classList.remove("btn__outline"),a.classList.add("btn__primary"),a.dataset.state="apply"))}g&&m?(g.addEventListener("click",()=>{m.classList.add("catalog-sidebar--mobile-open"),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.innerWidth<=T&&e.querySelectorAll(".catalog-filters__label").forEach(o=>{const i=o.parentElement,u=i.querySelector(".catalog-filters__checkboxes");i.classList.contains("filter-group--expanded")||(i.classList.add("filter-group--expanded"),requestAnimationFrame(()=>{u.style.maxHeight="none";const d=u.scrollHeight;u.style.maxHeight=d+"px",u.style.opacity="1"}))}),a&&(a.textContent="Применить фильтр",a.classList.remove("btn__outline"),a.classList.add("btn__primary"),a.dataset.state="apply")}),m.addEventListener("click",t=>{t.target===m&&S()}),n&&n.addEventListener("click",()=>{S()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&m.classList.contains("catalog-sidebar--mobile-open")&&S()}),a&&a.addEventListener("click",t=>{t.preventDefault(),(a.dataset.state||"apply")==="apply"?(h(),a.textContent="Показать",a.classList.remove("btn__primary"),a.classList.add("btn__outline"),a.dataset.state="show"):S()}),e.addEventListener("submit",t=>{t.preventDefault()})):e.addEventListener("submit",t=>{t.preventDefault(),h()}),h(),window.restoreFiltersFromURL=_,window.addEventListener("resize",()=>{const t=A();t!==E&&(E=t,f=1,y(s),w(c,v.length))})});function A(){return window.innerWidth<768?I:D}function O(e,s){if(s.types.length>0&&!s.types.includes(e.type))return!1;if(s.necks.length>0){let r=!1;if(s.necks.forEach(l=>{const p=`${e.neck} ${e.standard}`.trim();if(p.includes(l)||l.includes(p)){r=!0;return}if(e.neck&&(l===e.neck||e.neck.includes(l))){r=!0;return}if(e.neck&&e.neck.includes(";")&&e.neck.split(";").map(g=>g.trim()).some(g=>g.includes(l)||l.includes(g))){r=!0;return}}),!r)return!1}if(s.purposes.length>0){let r=!1;const l=e.purpose.split(";").map(p=>p.trim());if(s.purposes.forEach(p=>{if(l.some(c=>c.includes(p)||p.includes(c))){r=!0;return}}),!r)return!1}if(s.volumes.length>0&&e.volume){const r=parseFloat(e.volume.replace(" л","").replace(",","."));if(!s.volumes.some(p=>{const[c,g]=p.split("-").map(parseFloat);return r>=c&&r<=g}))return!1}return!(s.volumes.length>0&&!e.volume)}function B(e,s,r){return r==="priceAsc"?e.price-s.price:r==="priceDesc"?s.price-e.price:0}function H(e,s){if(!s)return;const r=M(e);s.textContent=`Найдено ${e} ${r}`}function M(e){const s=e%10,r=e%100;return s===1&&r!==11?"позиция":s>=2&&s<=4&&(r<10||r>=20)?"позиции":"позиций"}function w(e,s){var g,m;if(!e)return;const r=Math.ceil(s/E);if(r<=1){e.innerHTML="";return}const l=[];if(r<=5)for(let n=1;n<=r;n++)l.push(n);else if(f<=3){for(let n=1;n<=4;n++)l.push(n);l.push("ellipsis"),l.push(r)}else if(f>=r-2){l.push(1),l.push("ellipsis");for(let n=r-3;n<=r;n++)l.push(n)}else{l.push(1),l.push("ellipsis");for(let n=f-1;n<=f+1;n++)l.push(n);l.push("ellipsis"),l.push(r)}e.innerHTML=`
        <button class="catalog-pagination__btn catalog-pagination__btn--prev btn__outline" ${f===1?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Назад">
        </button>
        <div class="catalog-pagination__pages">
            ${l.map(n=>n==="ellipsis"?'<span class="pagination__ellipsis">...</span>':`<button class="catalog-pagination__page ${n===f?"catalog-pagination__page--active":""}" data-page="${n}">${n}</button>`).join("")}
        </div>
        <button class="catalog-pagination__btn catalog-pagination__btn--next btn__outline" ${f===r?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Вперед">
        </button>
    `;const c=document.querySelector('[data-product-grid="catalog"]');e.querySelectorAll(".catalog-pagination__page").forEach(n=>{n.addEventListener("click",()=>{f=parseInt(n.dataset.page),y(c),w(e,s);const a=c.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:a-88,behavior:"smooth"})})}),(g=e.querySelector(".catalog-pagination__btn--prev"))==null||g.addEventListener("click",()=>{if(f>1){f--,y(c),w(e,s);const n=c.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:n-88,behavior:"smooth"})}}),(m=e.querySelector(".catalog-pagination__btn--next"))==null||m.addEventListener("click",()=>{if(f<r){f++,y(c),w(e,s);const n=c.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:n-88,behavior:"smooth"})}})}function y(e){if(!e)return;const s=(f-1)*E,r=s+E,l=v.slice(s,r);$(e,l,"Нет товаров по заданным параметрам")}function U(){const e=document.querySelector(".catalog-filters");if(!e||window.innerWidth<1280)return;let s=!1,r=null,l=0;const p=16;function c(n){return n?e.contains(n)||n===e:!1}e.addEventListener("mouseenter",()=>{s=!0}),e.addEventListener("mouseleave",()=>{s=!1});function g(n){if(!s)return;const a=Date.now();if(a-l<p){n.preventDefault();return}const L=n.deltaY||n.detail||-n.wheelDelta,b=e.scrollHeight-e.clientHeight,h=e.scrollTop,k=h>0&&L<0,_=h<b&&L>0;if(k||_)return n.preventDefault(),n.stopPropagation(),r&&cancelAnimationFrame(r),r=requestAnimationFrame(()=>{e.scrollTop+=L*.8,l=a,r=null}),!1;s=!1}function m(n){c(n.target)&&n.stopPropagation()}e.addEventListener("wheel",g,{passive:!1}),e.addEventListener("touchmove",m,{passive:!0}),e.addEventListener("touchend",()=>{s=!1})}
