import"./form-P_CWeCT4.js";import{r as $,p as x}from"./main-NkK7DXXn.js";const F=12,B=9,P=1340;let y=T(),u=1,h=[...x];document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("catalogFilters"),n=document.querySelector('[data-product-grid="catalog"]'),s=document.querySelector("[data-product-count]"),r=document.getElementById("catalogSort"),m=document.getElementById("clearFilters"),c=document.querySelector("[data-pagination]"),f=document.querySelector("[data-catalog-filters-open]"),g=document.querySelector(".catalog-sidebar"),a=document.querySelector("[data-catalog-filters-close]"),l=e.querySelector(".catalog-filters__submit");if(!e||!n){console.error("Filter form or grid not found");return}C(),k();const E=new URLSearchParams(window.location.search).get("product");if(E){const t=()=>{const i=document.querySelector(`[data-product-id="${E}"], [data-productid="${E}"]`);if(i){const p=document.querySelector(".header"),d=p?p.offsetHeight:88,L=i.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:L-d-20,behavior:"smooth"}),i.style.transition="box-shadow 0.3s ease",i.style.boxShadow="0 0 0 3px rgba(93, 169, 255, 0.5)",setTimeout(()=>{i.style.boxShadow=""},2e3)}};setTimeout(t,500);const o=new MutationObserver(()=>{t(),o.disconnect()});o.observe(n,{childList:!0})}const b=()=>{const t=new FormData(e),o={types:t.getAll("type"),volumes:t.getAll("volume"),volumeFrom:t.get("volumeFrom"),volumeTo:t.get("volumeTo"),necks:t.getAll("neck"),purposes:t.getAll("purpose"),sort:r?r.value:"default"};h=x.filter(i=>I(i,o)),o.sort!=="default"&&(h=h.slice().sort((i,p)=>O(i,p,o.sort))),u=1,w(n),M(h.length,s),v(c,h.length),A(),q(o)};function q(t){const o=new URLSearchParams;t.types.length>0&&t.types.forEach(d=>o.append("type",d)),t.volumes.length>0&&t.volumes.forEach(d=>o.append("volume",d)),t.necks.length>0&&t.necks.forEach(d=>o.append("neck",d)),t.purposes.length>0&&t.purposes.forEach(d=>o.append("purpose",d)),t.sort&&t.sort!=="default"&&o.set("sort",t.sort);const i=new URLSearchParams(window.location.search).get("product");i&&o.set("product",i);const p=window.location.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},"",p),setTimeout(()=>{h.forEach((d,L)=>{const S=n.children[L];S&&(S.setAttribute("data-product-id",d.id),S.dataset.productId=d.id)})},100)}function k(){const t=new URLSearchParams(window.location.search);if(t.getAll("type").forEach(o=>{const i=e.querySelector(`input[name="type"][value="${o}"]`);i&&(i.checked=!0)}),t.getAll("volume").forEach(o=>{const i=e.querySelector(`input[name="volume"][value="${o}"]`);i&&(i.checked=!0)}),t.getAll("neck").forEach(o=>{const i=e.querySelector(`input[name="neck"][value="${o}"]`);i&&(i.checked=!0)}),t.getAll("purpose").forEach(o=>{const i=e.querySelector(`input[name="purpose"][value="${o}"]`);i&&(i.checked=!0)}),r){const o=t.get("sort");o&&(r.value=o)}}function A(){const o=n.getBoundingClientRect().top+window.pageYOffset-88;R(n)||window.scrollTo({top:o,behavior:"smooth"})}function R(t){const o=t.getBoundingClientRect();return o.top>=0&&o.left>=0&&o.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&o.right<=(window.innerWidth||document.documentElement.clientWidth)}function C(){e.querySelectorAll(".catalog-filters__label").forEach(o=>{const i=o.parentElement;i.classList.add("filter-group--expanded"),o.addEventListener("click",p=>{p.target.type!=="checkbox"&&i.classList.toggle("filter-group--expanded")})})}e.querySelectorAll('input[type="checkbox"]').forEach(t=>{t.addEventListener("change",()=>{window.innerWidth>P&&b()})}),r&&r.addEventListener("change",b),m&&m.addEventListener("click",()=>{e.reset(),b()});function _(){g&&(g.classList.remove("catalog-sidebar--mobile-open"),document.body.style.overflow="",document.documentElement.style.overflow="",l&&(l.textContent="Применить фильтр",l.classList.remove("btn__outline"),l.classList.add("btn__primary"),l.dataset.state="apply"))}f&&g?(f.addEventListener("click",()=>{g.classList.add("catalog-sidebar--mobile-open"),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.innerWidth<=P&&e.querySelectorAll(".catalog-filters__label").forEach(o=>{const i=o.parentElement,p=i.querySelector(".catalog-filters__checkboxes");i.classList.contains("filter-group--expanded")||(i.classList.add("filter-group--expanded"),requestAnimationFrame(()=>{p.style.maxHeight="none";const d=p.scrollHeight;p.style.maxHeight=d+"px",p.style.opacity="1"}))}),l&&(l.textContent="Применить фильтр",l.classList.remove("btn__outline"),l.classList.add("btn__primary"),l.dataset.state="apply")}),g.addEventListener("click",t=>{t.target===g&&_()}),a&&a.addEventListener("click",()=>{_()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&g.classList.contains("catalog-sidebar--mobile-open")&&_()}),l&&l.addEventListener("click",t=>{t.preventDefault(),(l.dataset.state||"apply")==="apply"?(b(),l.textContent="Показать",l.classList.remove("btn__primary"),l.classList.add("btn__outline"),l.dataset.state="show"):_()}),e.addEventListener("submit",t=>{t.preventDefault()})):e.addEventListener("submit",t=>{t.preventDefault(),b()}),b(),window.restoreFiltersFromURL=k,window.addEventListener("resize",()=>{const t=T();t!==y&&(y=t,u=1,w(n),v(c,h.length))})});function T(){return window.innerWidth<768?B:F}function I(e,n){if(n.types.length>0&&!n.types.includes(e.type))return!1;if(n.necks.length>0){let s=!1;if(n.necks.forEach(r=>{const m=`${e.neck} ${e.standard}`.trim();if(m.includes(r)||r.includes(m)){s=!0;return}if(e.neck&&(r===e.neck||e.neck.includes(r))){s=!0;return}if(e.neck&&e.neck.includes(";")&&e.neck.split(";").map(f=>f.trim()).some(f=>f.includes(r)||r.includes(f))){s=!0;return}}),!s)return!1}if(n.purposes.length>0){let s=!1;if(n.purposes.forEach(r=>{if(e.purpose.split(";").map(c=>c.trim()).some(c=>c.includes(r)||r.includes(c))){s=!0;return}}),!s)return!1}if(n.volumes.length>0&&e.volume){const s=parseFloat(e.volume.replace(" л","").replace(",","."));if(!n.volumes.some(m=>{const[c,f]=m.split("-").map(parseFloat);return s>=c&&s<=f}))return!1}return!(n.volumes.length>0&&!e.volume)}function O(e,n,s){return s==="priceAsc"?e.price-n.price:s==="priceDesc"?n.price-e.price:0}function M(e,n){if(!n)return;const s=D(e);n.textContent=`Найдено ${e} ${s}`}function D(e){const n=e%10,s=e%100;return n===1&&s!==11?"позиция":n>=2&&n<=4&&(s<10||s>=20)?"позиции":"позиций"}function v(e,n){var f,g;if(!e)return;const s=Math.ceil(n/y);if(s<=1){e.innerHTML="";return}const r=[];if(s<=5)for(let a=1;a<=s;a++)r.push(a);else if(u<=3){for(let a=1;a<=4;a++)r.push(a);r.push("ellipsis"),r.push(s)}else if(u>=s-2){r.push(1),r.push("ellipsis");for(let a=s-3;a<=s;a++)r.push(a)}else{r.push(1),r.push("ellipsis");for(let a=u-1;a<=u+1;a++)r.push(a);r.push("ellipsis"),r.push(s)}e.innerHTML=`
        <button class="catalog-pagination__btn catalog-pagination__btn--prev btn__outline" ${u===1?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Назад">
        </button>
        <div class="catalog-pagination__pages">
            ${r.map(a=>a==="ellipsis"?'<span class="pagination__ellipsis">...</span>':`<button class="catalog-pagination__page ${a===u?"catalog-pagination__page--active":""}" data-page="${a}">${a}</button>`).join("")}
        </div>
        <button class="catalog-pagination__btn catalog-pagination__btn--next btn__outline" ${u===s?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Вперед">
        </button>
    `;const c=document.querySelector('[data-product-grid="catalog"]');e.querySelectorAll(".catalog-pagination__page").forEach(a=>{a.addEventListener("click",()=>{u=parseInt(a.dataset.page),w(c),v(e,n);const l=c.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:l-88,behavior:"smooth"})})}),(f=e.querySelector(".catalog-pagination__btn--prev"))==null||f.addEventListener("click",()=>{if(u>1){u--,w(c),v(e,n);const a=c.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:a-88,behavior:"smooth"})}}),(g=e.querySelector(".catalog-pagination__btn--next"))==null||g.addEventListener("click",()=>{if(u<s){u++,w(c),v(e,n);const a=c.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:a-88,behavior:"smooth"})}})}function w(e){if(!e)return;const n=(u-1)*y,s=n+y,r=h.slice(n,s);$(e,r,"Нет товаров по заданным параметрам")}
