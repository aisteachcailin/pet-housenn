import"./form-JdZXZDeW.js";import{r as D,p as F}from"./main-CruvyS82.js";const I=12,O=9,T=768;let E=q(),g=1,v=[...F];document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("catalogFilters"),s=document.querySelector('[data-product-grid="catalog"]'),r=document.querySelector("[data-product-count]"),l=document.getElementById("catalogSort"),a=document.getElementById("clearFilters"),u=document.querySelector("[data-pagination]"),f=document.querySelector("[data-catalog-filters-open]"),m=document.querySelector(".catalog-sidebar"),t=document.querySelector("[data-catalog-filters-close]"),c=e.querySelector(".catalog-filters__submit");if(!e||!s)return;R(),S(),N();const b=new URLSearchParams(window.location.search).get("product");if(b){const o=()=>{const i=document.querySelector(`[data-product-id="${b}"], [data-productid="${b}"]`);if(i){const d=document.querySelector(".header"),p=d?d.offsetHeight:88,x=i.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:x-p-20,behavior:"smooth"}),i.style.transition="box-shadow 0.3s ease",i.style.boxShadow="0 0 0 3px rgba(93, 169, 255, 0.5)",setTimeout(()=>{i.style.boxShadow=""},2e3)}};setTimeout(o,500);const n=new MutationObserver(()=>{o(),n.disconnect()});n.observe(s,{childList:!0})}const h=()=>{const o=new FormData(e),n={types:o.getAll("type"),volumes:o.getAll("volume"),volumeFrom:o.get("volumeFrom"),volumeTo:o.get("volumeTo"),necks:o.getAll("neck"),purposes:o.getAll("purpose"),sort:l?l.value:"default"};v=F.filter(i=>$(i,n)),n.sort!=="default"?v=v.slice().sort((i,d)=>B(i,d,n.sort)):v.sort((i,d)=>(d.isNew?1:0)-(i.isNew?1:0)),g=1,L(s),H(v.length,r),y(u,v.length),A(),k(n)};function k(o){const n=new URLSearchParams;o.types.length>0&&o.types.forEach(p=>n.append("type",p)),o.volumes.length>0&&o.volumes.forEach(p=>n.append("volume",p)),o.necks.length>0&&o.necks.forEach(p=>n.append("neck",p)),o.purposes.length>0&&o.purposes.forEach(p=>{n.append("purpose",p)}),o.sort&&o.sort!=="default"&&n.set("sort",o.sort);const i=new URLSearchParams(window.location.search).get("product");i&&n.set("product",i);const d=window.location.pathname+(n.toString()?"?"+n.toString():"");window.history.replaceState({},"",d),setTimeout(()=>{v.forEach((p,x)=>{const P=s.children[x];P&&(P.setAttribute("data-product-id",p.id),P.dataset.productId=p.id)})},100)}function S(){const o=new URLSearchParams(window.location.search);if(o.getAll("type").forEach(n=>{const i=e.querySelector(`input[name="type"][value="${n}"]`);i&&(i.checked=!0)}),o.getAll("volume").forEach(n=>{const i=e.querySelector(`input[name="volume"][value="${n}"]`);i&&(i.checked=!0)}),o.getAll("neck").forEach(n=>{const i=e.querySelector(`input[name="neck"][value="${n}"]`);i&&(i.checked=!0)}),o.getAll("purpose").forEach(n=>{if(n.includes("|"))n.split("|").map(d=>d.trim()).forEach(d=>{const p=e.querySelector(`input[name="purpose"][value="${d}"]`);p&&(p.checked=!0)});else{const i=e.querySelector(`input[name="purpose"][value="${n}"]`);i&&(i.checked=!0)}}),l){const n=o.get("sort");n&&(l.value=n)}}function A(){const n=s.getBoundingClientRect().top+window.pageYOffset-88;C(s)||window.scrollTo({top:n,behavior:"smooth"})}function C(o){const n=o.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)}function R(){e.querySelectorAll(".catalog-filters__label").forEach(n=>{const i=n.parentElement;i.classList.add("filter-group--expanded"),n.addEventListener("click",d=>{d.target.type!=="checkbox"&&i.classList.toggle("filter-group--expanded")})})}e.querySelectorAll('input[type="checkbox"]').forEach(o=>{o.addEventListener("change",()=>{window.innerWidth>T&&h()})}),l&&l.addEventListener("change",h),a&&a.addEventListener("click",()=>{e.reset(),h()});function _(){m&&(m.classList.remove("catalog-sidebar--mobile-open"),document.body.style.overflow="",document.documentElement.style.overflow="",c&&(c.textContent="Применить фильтр",c.classList.remove("btn__outline"),c.classList.add("btn__primary"),c.dataset.state="apply"))}f&&m?(f.addEventListener("click",()=>{m.classList.add("catalog-sidebar--mobile-open"),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",window.innerWidth<=T&&e.querySelectorAll(".catalog-filters__label").forEach(n=>{const i=n.parentElement,d=i.querySelector(".catalog-filters__checkboxes");i.classList.contains("filter-group--expanded")||(i.classList.add("filter-group--expanded"),requestAnimationFrame(()=>{d.style.maxHeight="none";const p=d.scrollHeight;d.style.maxHeight=p+"px",d.style.opacity="1"}))}),c&&(c.textContent="Применить фильтр",c.classList.remove("btn__outline"),c.classList.add("btn__primary"),c.dataset.state="apply")}),m.addEventListener("click",o=>{o.target===m&&_()}),t&&t.addEventListener("click",()=>{_()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&m.classList.contains("catalog-sidebar--mobile-open")&&_()}),c&&c.addEventListener("click",o=>{o.preventDefault(),(c.dataset.state||"apply")==="apply"?(h(),c.textContent="Показать",c.classList.remove("btn__primary"),c.classList.add("btn__outline"),c.dataset.state="show"):_()}),e.addEventListener("submit",o=>{o.preventDefault()})):e.addEventListener("submit",o=>{o.preventDefault(),h()}),h(),window.restoreFiltersFromURL=S,window.addEventListener("resize",()=>{const o=q();o!==E&&(E=o,g=1,L(s),y(u,v.length))})});function q(){return window.innerWidth<768?O:I}function $(e,s){if(s.types.length>0&&!s.types.includes(e.type))return!1;if(s.necks.length>0){let r=!1;if(s.necks.forEach(l=>{const a=l.toLowerCase().trim(),u=e.neck?e.neck.toLowerCase().replace("мм","").trim():"",f=e.standard?e.standard.toLowerCase():"";if(a.includes("bericap")||a.includes("oil")||a.includes("bpf")||a.includes("pco")){const t=a.match(/\d+/),c=t&&u.includes(t[0]),w=f&&(a.includes("bericap")&&f.includes("bericap")||a.includes("oil")&&f.includes("oil")||(a.includes("bpf")||a.includes("pco"))&&(f.includes("bpf")||f.includes("pco")));c&&w&&(r=!0)}else{const t=a.match(/\d+/);t&&u.includes(t[0])&&(r=!0)}}),!r)return!1}if(s.purposes.length>0){let r=!1;const l=e.purpose.split(";").map(a=>a.trim());if(s.purposes.forEach(a=>{if(l.some(u=>u.includes(a)||a.includes(u))){r=!0;return}}),!r)return!1}if(s.volumes.length>0&&e.volume){const r=parseFloat(e.volume.replace(" л","").replace(",","."));if(!s.volumes.some(a=>{const[u,f]=a.split("-").map(parseFloat);return r>=u&&r<=f}))return!1}return!(s.volumes.length>0&&!e.volume)}function B(e,s,r){return r==="priceAsc"?e.price-s.price:r==="priceDesc"?s.price-e.price:0}function H(e,s){if(!s)return;const r=M(e);s.textContent=`Найдено ${e} ${r}`}function M(e){const s=e%10,r=e%100;return s===1&&r!==11?"позиция":s>=2&&s<=4&&(r<10||r>=20)?"позиции":"позиций"}function y(e,s){var f,m;if(!e)return;const r=Math.ceil(s/E);if(r<=1){e.innerHTML="";return}const l=[];if(r<=5)for(let t=1;t<=r;t++)l.push(t);else if(g<=3){for(let t=1;t<=4;t++)l.push(t);l.push("ellipsis"),l.push(r)}else if(g>=r-2){l.push(1),l.push("ellipsis");for(let t=r-3;t<=r;t++)l.push(t)}else{l.push(1),l.push("ellipsis");for(let t=g-1;t<=g+1;t++)l.push(t);l.push("ellipsis"),l.push(r)}e.innerHTML=`
        <button class="catalog-pagination__btn catalog-pagination__btn--prev btn__outline" ${g===1?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Назад">
        </button>
        <div class="catalog-pagination__pages">
            ${l.map(t=>t==="ellipsis"?'<span class="pagination__ellipsis">...</span>':`<button class="catalog-pagination__page ${t===g?"catalog-pagination__page--active":""}" data-page="${t}">${t}</button>`).join("")}
        </div>
        <button class="catalog-pagination__btn catalog-pagination__btn--next btn__outline" ${g===r?"disabled":""}>
            <img src="images/icons/arrow-blue.svg" alt="Вперед">
        </button>
    `;const u=document.querySelector('[data-product-grid="catalog"]');e.querySelectorAll(".catalog-pagination__page").forEach(t=>{t.addEventListener("click",()=>{g=parseInt(t.dataset.page),L(u),y(e,s);const c=u.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:c-88,behavior:"smooth"})})}),(f=e.querySelector(".catalog-pagination__btn--prev"))==null||f.addEventListener("click",()=>{if(g>1){g--,L(u),y(e,s);const t=u.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:t-88,behavior:"smooth"})}}),(m=e.querySelector(".catalog-pagination__btn--next"))==null||m.addEventListener("click",()=>{if(g<r){g++,L(u),y(e,s);const t=u.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:t-88,behavior:"smooth"})}})}function L(e){if(!e)return;const s=(g-1)*E,r=s+E,l=v.slice(s,r);D(e,l,"Нет товаров по заданным параметрам")}function N(){const e=document.querySelector(".catalog-filters");if(!e||window.innerWidth<1280)return;let s=!1,r=null,l=0;const a=16;function u(t){return t?e.contains(t)||t===e:!1}e.addEventListener("mouseenter",()=>{s=!0}),e.addEventListener("mouseleave",()=>{s=!1});function f(t){if(!s)return;const c=Date.now();if(c-l<a){t.preventDefault();return}const w=t.deltaY||t.detail||-t.wheelDelta,b=e.scrollHeight-e.clientHeight,h=e.scrollTop,k=h>0&&w<0,S=h<b&&w>0;if(k||S)return t.preventDefault(),t.stopPropagation(),r&&cancelAnimationFrame(r),r=requestAnimationFrame(()=>{e.scrollTop+=w*.8,l=c,r=null}),!1;s=!1}function m(t){u(t.target)&&t.stopPropagation()}e.addEventListener("wheel",f,{passive:!1}),e.addEventListener("touchmove",m,{passive:!0}),e.addEventListener("touchend",()=>{s=!1})}
